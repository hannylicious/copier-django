# ---
# META
# ---

_jinja_extensions:
  - jinja2_time.TimeExtension
_min_copier_version: "9.10.0"
_secret_questions:
  - django_secret_key
_subdirectory: template
_tasks:
  # Set Flags
  - "EXECUTED_BY_COPIER=1 {{_copier_python}} scripts/set_flags.py"
  # Remove scripts directory
  - "rm -rf scripts"
_exclude:
  # CODE EDITORS
  # Include 'defaults' for PyCharm IDE
  - "{% if editor != 'PyCharm' %}.idea{% endif %}"
  # If not using docker, we can remove specific docker commands for PyCharm
  - "{% if not use_docker and editor == 'PyCharm' %}.idea/runConfigurations/docker_compose_up_django.xml{% endif %}"
  - "{% if not use_docker and editor == 'PyCharm' %}.idea/runConfigurations/docker_compose_up_docs.xml{% endif %}"
  # LICENSES & CONTRIBUTORS
  # Not Open Source Projects
  - "{% if open_source_license == 'Not open source' %}LICENSE{% endif %}"
  - "{% if open_source_license == 'Not open source' %}CONTRIBUTORS.txt{% endif %}"
  # GPLv3 Projects
  - "{% if open_source_license != 'GPLv3' %}COPYING{% endif %}"
  # MANAGERS (AUTHENTICATION)
  - "{% if username_type != 'username' %}{{project_slug}}/users/tests/test_managers.py{% endif %}"
  - "{% if username_type != 'username' %}{{project_slug}}/users/managers.py{% endif %}"
  # DOCKER
  # Handles OS & Python specific dependancies
  - "{% if use_docker %}utility{% endif %}"
  # Nginx container is for hosting static media; not needed if no cloud
  - "{% if use_docker and cloud_provider == 'none' %}compose/production/nginx{% endif %}"
  # AWS container is for aws specifics; not needed if not using AWS
  - "{% if use_docker and cloud_provider != 'AWS' %}/compose/production/aws{% endif %}"
  # .devcontainer is used for setting up docker environments in ide's
  - "{% if not use_docker %}.devcontainer{% endif %}"
  # Compose stack and other docker related files not needed if not using docker
  - "{% if not use_docker %}compose{% endif %}"
  - "{% if not use_docker %}docker-compose.local.yml{% endif %}"
  - "{% if not use_docker %}docker-compose.production.yml{% endif %}"
  - "{% if not use_docker %}.dockerignore{% endif %}"
  # TODO: Keep this for other commands?
  - "{% if not use_docker %}justfile{% endif %}"
  # If we use heroku or docker, we need the env files; otherwise, we don't
  - "{% if not use_docker and not use_heroku %}/.envs{% endif %}"
  # Tests specific to merging envs; without envs, this is not needed
  - "{% if not use_docker and not use_heroku %}/tests{% endif %}"
  # Script to merge env files; without envs, this is not needed
  - "{% if not use_docker and not use_heroku %}merge_production_dotenvs_in_dotenv.py{% endif %}"
  # HEROKU
  # Specifies the commands that are executed by the app on startup
  - "{% if not use_heroku %}Procfile{% endif %}"
  # Contains scripts for the Heroku buildpack (collect static, compress, etc.)
  - "{% if not use_heroku %}/bin{% endif %}"
  # FRONTEND PIPELINE
  # Gulp specific setup / tasks
  - "{% if frontend_pipeline in ['None', 'Django Compressor', 'Webpack'] %}gulpfile.mjs{% endif %}"
  # Webpack specific setup / tasks
  - "{% if frontend_pipeline in ['None', 'Django Compressor', 'Gulp'] %}/webpack{% endif %}"
  # Imports for popper/bootstrap via webpack
  - "{% if frontend_pipeline in ['None', 'Django Compressor', 'Gulp'] %}{{project_slug}}/static/js/vendors.js{% endif %}"
  # These files require building which only Gulp/Webpack handle (sass/scss)
  - "{% if frontend_pipeline in ['None', 'Django Compressor'] %}{{project_slug}}/static/sass{% endif %}"
  # Node requirements only needed by Gulp/Webpack
  - "{% if frontend_pipeline in ['None', 'Django Compressor'] %}package.json{% endif %}"
  # Node is unnecessary if we are not using Gulp/Webpack
  - "{% if frontend_pipeline in ['None', 'Django Compressor'] and use_docker %}compose/local/node{% endif %}"
  # These pipelines automatically create this file - not needed in this case
  - "{% if frontend_pipeline in ['Gulp', 'Webpack'] %}{{project_slug}}/static/css/project.css{% endif %}"
  # CELERY
  # If we are not using celery, we can remove all related files
  - "{% if not use_celery %}config/celery_app.py{% endif %}"
  - "{% if not use_celery %}{{project_slug}}/users/tasks.py{% endif %}"
  - "{% if not use_celery %}{{project_slug}}/users/tests/test_tasks.py{% endif %}"
  # If we are not using celery, we can remove the celery container(s)
  - "{% if not use_celery and use_docker %}compose/local/django/celery{% endif %}"
  - "{% if not use_celery and use_docker %}compose/production/django/celery{% endif %}"
  # CI TOOLS
  - "{% if ci_tool != 'Travis' %}.travis.yml{% endif %}"
  - "{% if ci_tool != 'Gitlab' %}.gitlab-ci.yml{% endif %}"
  - "{% if ci_tool != 'Github' %}.github{% endif %}"
  - "{% if ci_tool != 'Drone' %}.drone.yml{% endif %}"
  # DJANGO REST FRAMEWORK / DJANGO NINJA
  - "{% if not use_drf and not use_django_ninja %}config/api_router.py{% endif %}"
  - "{% if not use_drf and not use_django_ninja %}{{project_slug}}/users/api{% endif %}"
  - "{% if not use_drf and not use_django_ninja %}{{project_slug}}/users/tests/api{% endif %}"
  # Django Ninja does not need serializers
  - "{% if not use_drf and use_django_ninja %}{{project_slug}}/users/api/serializers.py{% endif %}"
  # ASYNC
  - "{% if not use_async %}config/asgi.py{% endif %}"
  # Without async, websockets is not needed
  - "{% if not use_async %}config/websocket.py{% endif %}"

# ---
# GENERAL
# ---

project_name:
  type: str
  default: "My Project"
  help: The name of your project.
project_slug:
  type: str
  default: "{{ project_name.lower()|replace(' ', '_')|replace('-', '_')|replace('.', '_')|trim() }}"
  help: The slug for your project, used in directory and file names.
  validator: >-
    {% if not project_slug.isidentifier() %}
      This is not a valid Python identifier.
    {% elif project_slug in ['False', 'None', 'True', 'and', 'as', 'assert', 'async', 'await', 'break', 'class', 'continue', 'def', 'del', 'elif', 'else', 'except', 'finally', 'for', 'from', 'global', 'if', 'import', 'in', 'is', 'lambda', 'nonlocal', 'not', 'or', 'pass', 'raise', 'return', 'try', 'while', 'with', 'yield'] %}
      This is a Python keyword and cannot be used as an identifier.
    {% elif not project_slug == project_slug.lower() %}
      The project slug must be all lowercase.
    {% endif %}
description:
  type: str
  default: "Welcome To My Project!"
  help: A short description of the project.
author_name:
  type: str
  default: "John Doe"
  help: The name of the project's author.
  validator: >-
    {% if "\\" in author_name %}
      Please do not use backslashes in the author name.
    {% endif %}
django_secret_key:
  type: str
  default: "!!!change_this_secret_key!!!"
  help: The secret key for Django
  secret: true
domain_name:
  type: str
  default: "example.com"
  help: The domain name for the project.
  validator: >-
    {% if domain_name != domain_name.strip() %}
    The domain name cannot have leading or trailing spaces.
    {% elif " " in domain_name %}
    The domain name cannot contain spaces.
    {% endif %}
email:
  type: str
  default: "{{ author_name.lower() | trim() |replace(' ', '-') }}@{{ domain_name.lower() | trim() }}"
  help: The author's email address.
  validator: >-
    {% if email != email.strip() %}
    The email cannot have leading or trailing spaces.
    {% elif " " in email %}
    The email cannot contain spaces.
    {% endif %}
version:
  type: str
  default: "0.1.0"
  help: The initial version of the project.
allow_commits_to_main:
  type: bool
  default: false
  help: Allow commits to the main/master branch (pre-commit hook)?
open_source_license:
  type: str
  choices:
    - "MIT"
    - "BSD"
    - "GPLv3"
    - "Apache Software License 2.0"
    - "Not open source"
  help: Choose a license for your project.
username_type:
  type: str
  choices:
    - "username"
    - "email"
  help: How do users log in?
timezone:
  type: str
  default: "America/Chicago"
  help: The timezone for the project's settings.
windows:
  type: bool
  default: false
  help: Set to true if you need Windows compatibility.
use_docker:
  type: bool
  default: true
  help: Use Docker for development and deployment?
postgresql_version:
  type: str
  choices:
    - "17"
    - "16"
    - "15"
    - "14"
  help: Select the PostgreSQL version for your project.
cloud_provider:
  type: str
  default: "None"
  choices:
    - "None"
    - "AWS"
    - "GCP"
    - "Azure"
  help: >
    Choose your cloud provider.
    {% if cloud_provider == "None" and not use_docker %}

      You chose to not use any cloud providers nor Docker,
      media files won't be served in production.
    {% endif %}

mail_service:
  type: str
  choices:
    - "Mailgun"
    - "Amazon SES"
    - "Mailjet"
    - "Mandrill"
    - "Postmark"
    - "Sendgrid"
    - "Brevo"
    - "SparkPost"
    - "Other SMTP"
  help: >
    Select a mail service for your project.
frontend_pipeline:
  type: str
  default: "None"
  choices:
    - "None"
    - "Django Compressor"
    - "Gulp"
    - "Webpack"
  help: How do you want to manage your frontend assets?
use_async:
  type: bool
  default: false
  help: Do you want to use async features in Django?
use_drf:
  type: bool
  default: false
  help: Include Django Rest Framework (DRF)?
use_django_ninja:
  type: bool
  default: false
  help: Include Django Ninja?
  when: "{{ use_drf != true }}"
use_celery:
  type: bool
  default: false
  help: Use Celery for background tasks?
use_mailpit:
  type: bool
  default: true
  help: Use Mailpit for local email testing?
use_sentry:
  type: bool
  default: true
  help: Use Sentry SDK for error tracking?
use_whitenoise:
  type: bool
  default: true
  help: >
    Use Whitenoise to serve static files?
    {% if cloud_provider == "None" %}
    You have not selected a cloud provider.

      Using whitenoise is highly recommended in this case.
    {% endif %}
editor:
  type: str
  default: "None"
  choices:
    - "None"
    - "PyCharm"
    - "VS Code"
  help: Which code editor do you use?
ci_tool:
  type: str
  default: "None"
  choices:
    - "None"
    - "Github"
    - "Gitlab"
    - "Travis"
    - "Drone"
  help: Which continuous integration tool do you prefer?
use_heroku:
  type: bool
  default: false
  help: Deploy to Heroku?
keep_local_envs_in_vcs:
  type: bool
  default: false
  help: >
    Keep local environment files in version control?
  validator: >-
    {% if keep_local_envs_in_vcs and not use_docker and not use_heroku %}
      .env(s) are only utilized when Docker Compose and/or
      Heroku support is enabled so keeping them does not make sense
      given your current setup.
    {% endif %}
debug:
  type: bool
  default: false
  help: Enable debug mode by default?
